var light=angular.module("light",["ngAnimate","ngRoute","light.services","light.controllers","light.directives"]);light.run(["$rootScope","$location","Local",function(e,r,t){e.location=r,e.$on("$routeChangeStart",function(e,o){var i=t.get("user");o.public||i||r.path("login")})}]),light.config(["$httpProvider","$routeProvider","$locationProvider",function(e,r){e.interceptors.push("httpInterceptor"),r.when("/",{templateUrl:"views/login.html",controller:"Login","public":!0}).when("/dashboard",{templateUrl:"views/dashbard.html",controller:"Dashbard","public":!1,resolve:{user:["Local","LoginService",function(e,r){var t=e.get("user");if(t){var o=r.resolve({email:t.email,pass:t.pass});return o}}]}}).when("/credit",{templateUrl:"views/credit.html",controller:"Credit","public":!1,resolve:{user:["Local","LoginService",function(e,r){var t=e.get("user");if(t){var o=r.resolve({email:t.email,pass:t.pass});return o}}]}}).when("/debit",{templateUrl:"views/debit.html",controller:"Debit","public":!1,resolve:{user:["Local","LoginService",function(e,r){var t=e.get("user");if(t){var o=r.resolve({email:t.email,pass:t.pass});return o}}]}}).otherwise({redirectTo:"/"})}]);var controllers=angular.module("light.controllers",["ngDialog"]);controllers.controller("Login",["Local","ngDialog","$scope","$location","LoginService",function(e,r,t,o,i){t.login=function(){i.send({email:t.email,pass:t.pass}).success(function(i){i.error?(t.error=i.error,r.open({template:"views/include/error.html",scope:t})):(e.set("user",i),o.path("dashboard"))})}}]),controllers.controller("Dashbard",["user","HistoryService","$scope","$location",function(e,r,t,o){t.user=e,r.get({email:t.user.email}).success(function(e){t.history=e.history,t.graph=e.graph,t.avarage=e.avarage}),t.goToCredit=function(){o.path("credit")},t.goToDebit=function(){o.path("debit")}}]),controllers.controller("Credit",["user","ngDialog","$scope","$location",function(e,r,t,o){t.user=e,t.buy=function(){t.credit?r.open({template:"views/include/credit-card.html",controller:"CreditCard",scope:t}):(t.error="Selecione um valor para recarregar",r.open({template:"views/include/error.html",scope:t}))},t.goBack=function(){o.path("dashboard")}}]),controllers.controller("CreditCard",["CreditService","$scope","$location",function(e,r,t){r.buy=function(){e.update({balance:r.user.balance,email:r.user.email,credit:r.credit}).success(function(){r.closeThisDialog(),t.path("dashboard")})},r.goBack=function(){r.closeThisDialog(),t.path("credit")}}]),controllers.controller("Debit",["user","DebitService","HistoryService","$scope","$location",function(e,r,t,o,i){o.user=e,o.debit=function(){r.send({email:o.user.email,balance:o.user.balance,kwh:o.user.kwh}).success(function(){i.path("dashboard")})},o.reset=function(){t.reset({email:o.user.email}).success(function(){i.path("dashboard")})},o.goBack=function(){i.path("dashboard")}}]);var directives=angular.module("light.directives",[]);directives.directive("loader",["$rootScope",function(){return{restrict:"E",link:function(e,r){return e.$on("loader:show",function(){return r.show()}),e.$on("loader:hide",function(){return r.hide()})}}}]),directives.directive("bar",["$timeout",function(e){return{restrict:"E",template:"<div></div>",replace:!0,scope:{graph:"="},link:function(r,t,o){console.log(o),r.$watch("graph",function(){r.graph?e(function(){i()},400):r.chart&&r.chart.load({columns:[r.graph.kWh]})});var i=function(){r.graph.kWh.length>1&&(r.chart=c3.generate({bindto:"#"+o.id,size:{height:250},data:{columns:[r.graph.kWh],type:"bar",colors:{kWh:"#27AAAF"},labels:{format:{y:function(e,r){return e+" "+r}}}},axis:{x:{type:"categorized",categories:["dia 1","dia 2","dia 3","dia 4","dia 5","dia 6","dia 7"]}},tooltip:{show:!1},legend:{show:!1}}))}}}}]);var services=angular.module("light.services",[]);services.factory("LoginService",["$http","$rootScope","Local",function(e,r,t){var o="/login",i={};return i.send=function(r){var t=e.post(o,r);return t},i.resolve=function(i){var n=e.post(o,i).then(function(e){var o=e.data;return t.set("user",o),r.user=o,o});return n},i}]),services.factory("CreditService",["$http",function(e){var r="/credit",t={};return t.update=function(t){var o=e.post(r,t);return o},t}]),services.factory("DebitService",["$http",function(e){var r="/debit",t={};return t.send=function(t){var o=e.post(r,t);return o},t}]),services.factory("HistoryService",["$http",function(e){var r="/history",t="/reset",o={};return o.get=function(t){var o=e.post(r,t);return o},o.reset=function(r){var o=e.post(t,r);return o},o}]),services.factory("Local",["$rootScope",function(){var e={};return e.set=function(e,r){localStorage.setItem(e,JSON.stringify(r))},e.get=function(e){var r=localStorage.getItem(e);return JSON.parse(r)},e}]),services.factory("httpInterceptor",["$q","$rootScope",function(e,r){var t=0;return{request:function(o){return t++,r.$broadcast("loader:show"),o||e.when(o)},response:function(o){return 0===--t&&r.$broadcast("loader:hide"),o||e.when(o)},responseError:function(o){return--t||r.$broadcast("loader:hide"),e.reject(o)}}}]);