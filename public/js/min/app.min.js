var light=angular.module("light",["ngAnimate","ngRoute","light.services","light.controllers","light.directives","light.templates"]);light.run(["$rootScope","$location","Local",function(t,e,n){t.location=e,t.$on("$routeChangeStart",function(t,a){var r=n.get("user");a.public||r||e.path("login")})}]),light.config(["$httpProvider","$routeProvider","$locationProvider",function(t,e){t.interceptors.push("httpInterceptor"),e.when("/",{templateUrl:"login.html",controller:"Login","public":!0}).when("/dashboard",{templateUrl:"dashboard.html",controller:"Dashbard","public":!1,resolve:{user:["Local","LoginService",function(t,e){var n=t.get("user");if(n){var a=e.resolve({email:n.email,pass:n.pass});return a}}]}}).when("/credit",{templateUrl:"credit.html",controller:"Credit","public":!1,resolve:{user:["Local","LoginService",function(t,e){var n=t.get("user");if(n){var a=e.resolve({email:n.email,pass:n.pass});return a}}]}}).when("/debit",{templateUrl:"debit.html",controller:"Debit","public":!1,resolve:{user:["Local","LoginService",function(t,e){var n=t.get("user");if(n){var a=e.resolve({email:n.email,pass:n.pass});return a}}]}}).otherwise({redirectTo:"/"})}]),angular.module("light.templates",[]).run(["$templateCache",function(t){t.put("credit.html",'<section class="app-section">\n  <div class="app-user-area" data-ng-include="\'include/balance.html\'"></div>\n\n  <div class="app-content">\n    <h4>Quanto deseja recarregar:</h4>\n\n    <div class="row credit-area">\n      <div class="col-xs-6">\n        <label data-ng-class="{ \'credit-selected\': credit == 5 }" class="credit-btn btn btn-lg btn-block btn-default">\n          R$ 5\n          <input class="credit-radio" type="radio" data-ng-model="credit" value="5">\n        </label>\n      </div>\n      <div class="col-xs-6">\n        <label data-ng-class="{ \'credit-selected\': credit == 10 }" class="credit-btn btn btn-lg btn-block btn-default">\n          R$ 10\n          <input class="credit-radio" type="radio" data-ng-model="credit" value="10">\n        </label>\n      </div>\n      <div class="col-xs-6">\n        <label data-ng-class="{ \'credit-selected\': credit == 20 }" class="credit-btn btn btn-lg btn-block btn-default">\n          R$ 20\n          <input class="credit-radio" type="radio" data-ng-model="credit" value="20">\n        </label>\n      </div>\n      <div class="col-xs-6">\n        <label data-ng-class="{ \'credit-selected\': credit == 50 }" class="credit-btn btn btn-lg btn-block btn-default">\n          R$ 50\n          <input class="credit-radio" type="radio" data-ng-model="credit" value="50">\n        </label>\n      </div>\n    </div>\n\n    <div class="credit-buttons">\n      <button data-ng-click="buy()"    class="btn btn-lg btn-block btn-success">Comprar</button>\n      <button data-ng-click="goBack()" class="btn btn-lg btn-block btn-default">Cancelar</button>\n    </div>\n  </div>\n</section>\n'),t.put("dashboard.html",'<section class="app-section">\n  <div class="app-user-area" data-ng-include="\'include/balance.html\'"></div>\n\n  <div class="app-content">\n    <h4 data-ng-show="history">Histórico dos últimos 10 dias:</h4>\n    <bar id="chart" data-graph="graph"></bar>\n\n    <div ng-hide="{{ user.kwh == 20 }}" class="panel panel-warning">\n      <div class="panel-heading">\n        <h3 class="panel-title text-center">kWh consumidos este mês</h3>\n      </div>\n      <div class="panel-body text-center"><strong>{{ user.kwh }}</strong>kWh</div>\n    </div>\n\n    <table data-ng-show="history" class="table table-striped table-bordered">\n      <thead>\n        <tr>\n          <th class="text-center">#</th>\n          <th class="text-center">kWh</th>\n          <th class="text-center">Preço</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr data-ng-repeat="h in history">\n          <td class="text-center">dia {{ $index + 1 }}</td>\n          <td class="text-center"><strong>{{ h.consumed }}</strong>kWh</td>\n          <td class="text-center">R$ <strong>{{ h.price }}</strong></td>\n        </tr>\n      </tbody>\n    </table>\n\n    <div class="credit-buttons">\n      <button data-ng-click="goToCredit()" class="btn btn-block btn-lg btn-success">Adicionar crédito</button>\n      <button ng-show="user.balance > 0" data-ng-click="goToDebit()"  class="btn btn-block btn-lg btn-default">Debitar usuário</button>\n    </div>\n  </div>\n</section>\n'),t.put("debit.html",'<section class="app-section">\n  <div class="app-user-area" data-ng-include="\'include/balance.html\'"></div>\n\n  <div class="app-content">\n    <div class="credit-buttons">\n      <button data-ng-click="debit()"  class="btn btn-lg btn-block btn-yellow">Debitar diaria</button>\n      <button data-ng-click="goBack()" class="btn btn-lg btn-block btn-default">Cancelar</button>\n    </div>\n    <div class="credit-buttons">\n      <button data-ng-click="reset()"  class="btn btn-lg btn-block btn-danger">Limpar histórico</button>\n    </div>\n  </div>\n</section>\n'),t.put("login.html",'<form class="login-area" data-ng-submit="login()">\n  <div class="form-group">\n    <label for="email">Email</label>\n    <input type="email" data-ng-model="email" class="input-lg form-control" id="email" placeholder="Digite seu email">\n  </div>\n\n  <div class="form-group">\n    <label for="pass">Senha</label>\n    <input type="password" data-ng-model="pass" class="input-lg form-control" id="pass" placeholder="Digite sua senha">\n  </div>\n\n  <button type="submit" class="btn btn-lg btn-block btn-yellow">Entrar</button>\n</form>\n'),t.put("include/balance.html",'<div class="user-balance text-center">\n  Seu saldo é R$ <strong>{{ user.balance }}</strong>\n</div>\n'),t.put("include/credit-card.html",'<h4>Selecione seu cartão</h4>\n\n<select data-ng-module="card" class="form-control input-lg card-select">\n  <option value="xxxx-xxxx-xxxx-8979" selected>xxxx-xxxx-xxxx-8979</option>\n  <option value="xxxx-xxxx-xxxx-5492">xxxx-xxxx-xxxx-5492</option>\n</select>\n<p class="text-right">Pague com <img src="img/zuum.png"></p>\n\n<div class="credit-buttons">\n  <button data-ng-click="buy()"     class="btn btn-lg btn-block btn-success">Finalizar compra</button>\n  <button data-ng-click="goBack()"  class="btn btn-lg btn-block btn-default">Cancelar</button>\n</div>\n'),t.put("include/error.html",'<h4 class="text-center">{{ error }}</h4>\n'),t.put("include/header.html",'<a href="#dashboard" class="logo">Light</a>\n')}]);var controllers=angular.module("light.controllers",["ngDialog"]);controllers.controller("Login",["Local","ngDialog","$scope","$location","LoginService",function(t,e,n,a,r){n.login=function(){r.send({email:n.email,pass:n.pass}).success(function(r){r.error?(n.error=r.error,e.open({template:"include/error.html",scope:n})):(t.set("user",r),a.path("dashboard"))})}}]),controllers.controller("Dashbard",["user","HistoryService","$scope","$location",function(t,e,n,a){n.user=t,e.get({email:n.user.email}).success(function(t){n.history=t.history,n.graph=t.graph,n.avarage=t.avarage}),n.goToCredit=function(){a.path("credit")},n.goToDebit=function(){a.path("debit")}}]),controllers.controller("Credit",["user","ngDialog","$scope","$location",function(t,e,n,a){n.user=t,n.buy=function(){n.credit?e.open({template:"include/credit-card.html",controller:"CreditCard",scope:n}):(n.error="Selecione um valor para recarregar",e.open({template:"include/error.html",scope:n}))},n.goBack=function(){a.path("dashboard")}}]),controllers.controller("CreditCard",["CreditService","$scope","$location",function(t,e,n){e.buy=function(){t.update({balance:e.user.balance,email:e.user.email,credit:e.credit}).success(function(){e.closeThisDialog(),n.path("dashboard")})},e.goBack=function(){e.closeThisDialog(),n.path("credit")}}]),controllers.controller("Debit",["user","DebitService","HistoryService","$scope","$location",function(t,e,n,a,r){a.user=t,a.debit=function(){e.send({email:a.user.email,balance:a.user.balance,kwh:a.user.kwh}).success(function(){r.path("dashboard")})},a.reset=function(){n.reset({email:a.user.email}).success(function(){r.path("dashboard")})},a.goBack=function(){r.path("dashboard")}}]);var directives=angular.module("light.directives",[]);directives.directive("loader",["$rootScope",function(){return{restrict:"E",link:function(t,e){return t.$on("loader:show",function(){return e.show()}),t.$on("loader:hide",function(){return e.hide()})}}}]),directives.directive("bar",["$timeout",function(t){return{restrict:"E",template:"<div></div>",replace:!0,scope:{graph:"="},link:function(e,n,a){e.$watch("graph",function(){e.graph?t(function(){r()},400):e.chart&&e.chart.load({columns:[e.graph.kWh]})});var r=function(){e.graph.kWh.length>1&&(e.chart=c3.generate({bindto:"#"+a.id,size:{height:250},data:{columns:[e.graph.kWh],type:"bar",colors:{kWh:"#27AAAF"},labels:{format:{y:function(t,e){return t+" "+e}}}},axis:{x:{type:"categorized",categories:["dia 1","dia 2","dia 3","dia 4","dia 5","dia 6","dia 7","dia 8","dia 9","dia 10","dia 11","dia 12","dia 13","dai 14"]}},tooltip:{show:!1},legend:{show:!1},interaction:{enabled:!1}}))}}}}]);var services=angular.module("light.services",[]);services.factory("LoginService",["$http","$rootScope","Local",function(t,e,n){var a="/login",r={};return r.send=function(e){var n=t.post(a,e);return n},r.resolve=function(r){var o=t.post(a,r).then(function(t){var a=t.data;return n.set("user",a),e.user=a,a});return o},r}]),services.factory("CreditService",["$http",function(t){var e="/credit",n={};return n.update=function(n){var a=t.post(e,n);return a},n}]),services.factory("DebitService",["$http",function(t){var e="/debit",n={};return n.send=function(n){var a=t.post(e,n);return a},n}]),services.factory("HistoryService",["$http",function(t){var e="/history",n="/reset",a={};return a.get=function(n){var a=t.post(e,n);return a},a.reset=function(e){var a=t.post(n,e);return a},a}]),services.factory("Local",["$rootScope",function(){var t={};return t.set=function(t,e){localStorage.setItem(t,JSON.stringify(e))},t.get=function(t){var e=localStorage.getItem(t);return JSON.parse(e)},t}]),services.factory("httpInterceptor",["$q","$rootScope",function(t,e){var n=0;return{request:function(a){return n++,e.$broadcast("loader:show"),a||t.when(a)},response:function(a){return 0===--n&&e.$broadcast("loader:hide"),a||t.when(a)},responseError:function(a){return--n||e.$broadcast("loader:hide"),t.reject(a)}}}]);